<!-- この文書は詳細な要件を網羅的に整理し、実装とレビューの基準にするためのコメントです。 -->
# Idle Dungeon (仮) 詳細要件定義

## 前提と範囲
- Neovim内で完結する放置型ゲームを対象とする。
- 右下の小さな表示が主な出力であり、派手な演出は行わない。
- シナリオは選択肢のない一本道とする。

## 用語
- ステージ: 進行距離と敵強度をまとめた区間。
- 会話: 自動進行する台詞イベント。
- 実績: 入力や作業の量に応じて解放される条件。
- 仲間: 装備枠の一つで、固有効果を持つ同行者。

## 機能要件
### ゲーム起動と自動進行
- 起動直後から主人公は自動で右方向へ進む。
- 移動、戦闘、会話、報酬は自動進行で完結する。
- 自動進行の周期と会話の待機時間は設定で変更できる。

### 状態と遷移
- 状態は「移動中」「戦闘中」「会話中」「報酬表示」「敗北」を持つ。
- 状態遷移は1つの管理関数で行い、遷移ログを残す。

### 移動と探索
- 距離は一定間隔で増加し、距離に応じてイベントを発生させる。
- 右方向へ進むほど敵の強さと報酬が増える。
<!-- この項目は無限進行のラストダンジョンを明確にするためのコメントです。 -->
- ラストダンジョンは距離が無限で、敗北まで自動で進み続ける。
<!-- この項目はステージ進行を明確にするためのコメントです。 -->
- ステージの終端距離に到達すると次のステージへ自動的に進む。

### 戦闘
- 戦闘は自動で進み、結果は短いログで表示する。
- 勝利時は経験値とゴールドを獲得する。
- 敗北時はステージ開始地点へ戻り、レベルと装備は保持する。

### イベントと会話
- 会話は既定12秒で自動進行し、残り秒数のインジケータを表示する。
- 会話は必ず一本道で、選択肢は表示しない。
- 会話やイベントは中断されず、設定時間で必ず次へ進む。

### 報酬と経済
- ゴールドは戦闘とイベントで獲得する。
- 武器と防具の購入、売却はメニューから行う。
- 価格は段階的に上昇し、入手速度が早すぎないよう調整する。

### 成長とレベル
- 経験値が閾値に達するとレベルが上がる。
- ステータスポイントの手動配分と自動配分を選べる。
- 自動配分はテンプレートとして複数用意する。

### 装備と仲間
- 装備枠は武器、防具、装身具、仲間の4つとする。
- 装備と仲間の組み合わせで追加効果が発生する。
- 装備の切り替えは戦闘中以外で行える。

### 入力実績と解放
- 入力文字数、行数、保存回数、連続作業時間を記録する。
- ファイル種別ごとの入力量も記録する。
- 実績達成で装備、称号、キャラクターが解放される。
- 解放状態はメニューで確認できる。

### メニュー
- クリックまたは `:IdleDungeonMenu` でメニューを開く。
- メニューから装備変更、開始ダンジョン設定、購入と販売、キャラクター変更ができる。
- メニューはキーボードだけで完結する。
<!-- この項目は言語切り替えを明確にするためのコメントです。 -->
- メニューの既定言語は英語とし、メニュー内で日本語を選択できる。
<!-- この項目はメニュー表示の配置を明確にするためのコメントです。 -->
- メニューは画面中央に浮動ウィンドウとして表示する。
<!-- この項目は初期化機能の要件を明確にするためのコメントです。 -->
- メニューから全データ初期化の確認画面を開き、確定時に初期状態へ戻す。

### 設定
- 進行速度、会話時間、描画頻度、保存間隔を設定できる。
- 最小表示モードと詳細表示モードを切り替えられる。
<!-- この項目は自動開始の設定を明確にするためのコメントです。 -->
- 自動開始は既定で有効とし、メニューで有効と無効を切り替えられる。

### 保存と復帰
- 進行状況、装備、実績はローカルに保存する。
- 自動保存は一定間隔で行い、手動保存も可能にする。
- 保存は一時ファイルを使い、破損を防ぐ。
<!-- この項目は複数起動時の整合性を明確にするためのコメントです。 -->
- データはユーザー単位で1つの保存先を持ち、プロジェクトごとに分断しない。
- 複数のNeovimが起動している場合はロックにより単一インスタンスが更新を担当する。

### ログと通知
- 重要な戦闘結果と解放は簡潔なログで示す。
- 作業の邪魔を避けるため通知は控えめにする。

### Git連携(任意)
- Gitのユーザー情報を読み取り、ローカルランキングの表示名に利用できる。
- ランキングへの登録はメニューから明示的に行う。
- ネットワーク通信は既定で無効とし、明示操作でのみ行う。

## データ要件
- プレイヤー、装備、実績、進行距離、設定を一つの状態構造体で管理する。
- 状態は整合性検証を行い、破損時は安全に初期化する。

## 非機能要件
- Neovim操作に体感的な遅延を与えない。
- 画面更新は最小限に抑え、ちらつきを避ける。
- 画面サイズ変更に追従し、常に右下へ表示する。
- 右下表示は1行を既定とし、最大2行までに制限する。
<!-- この項目はペット表示の見た目要件を明確にするためのコメントです。 -->
- 可視モードはドット調のペットを1行内で歩行させ、視認性を保つ。
<!-- この項目は情報表示の強化を明確にするためのコメントです。 -->
- 表示設定が2行のときはステージ進行度、体力、レベル、次のイベントなどが確認できる。
- ローカルの個人情報は外部送信しない。
- 設定やセーブデータは壊れにくい形式で保存する。
- テストは関数単位で検証しやすい構成にする。

## 受け入れ基準
- 自動で右へ進み、会話も時間で進行する。
- 敗北後はステージ開始地点へ戻り、レベルと装備が保持される。
- メニューから装備変更、開始ダンジョン設定、購入と販売、キャラクター変更ができる。
- 入力実績による装備や称号の解放が確認できる。
- 保存と復帰が安定して行える。
- ネットワーク通信が既定で無効である。

## 制約と除外
- マルチプレイやリアルタイム協力は対象外とする。
- 音声や高負荷な演出は実装しない。
